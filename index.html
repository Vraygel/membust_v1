<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Memboost - –ò–∑—É—á–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Arial', sans-serif;
		}

		body {
			background: #F1F5D8;
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 20px;
		}

		.app-container {
			width: 100%;
			max-width: 400px;
		}

		.header {
			text-align: center;
			margin-bottom: 40px;
		}

		.logo {
			font-size: 3rem;
			margin-bottom: 10px;
			color: #006767;
		}

		.title {
			font-size: 2.5rem;
			font-weight: bold;
			color: #006767;
			margin-bottom: 10px;
		}

		.subtitle {
			font-size: 1.1rem;
			color: #008080;
		}

		/* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
		.container {
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.form {
			display: flex;
			justify-content: center;
			align-items: center;
			transform-style: preserve-3d;
			transition: all 1s ease;
			width: 100%;
		}

		.form .form_front,
		.form .form_back {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			gap: 20px;
			position: absolute;
			backface-visibility: hidden;
			padding: 50px 35px;
			border-radius: 20px;
			width: 100%;
			background: #008080;
			box-shadow: inset 2px 2px 10px rgba(0, 0, 0, 0.1),
				inset -1px -1px 5px rgba(255, 255, 255, 0.4),
				15px 15px 40px rgba(0, 0, 0, 0.15);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.form .form_back {
			transform: rotateY(-180deg);
		}

		.form_details {
			font-size: 28px;
			font-weight: 700;
			padding-bottom: 10px;
			color: #ffffff;
			text-align: center;
		}

		.input {
			width: 100%;
			min-height: 50px;
			color: #2d3748;
			outline: none;
			transition: 0.35s;
			padding: 0px 15px;
			background-color: #F1F5D8;
			border-radius: 12px;
			border: 2px solid #B9FFAF;
			font-size: 16px;
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.1),
				1px 1px 5px rgba(255, 255, 255, 0.3);
		}

		.input::placeholder {
			color: #718096;
		}

		.input:focus {
			transform: scale(1.02);
			border-color: #97FA9A;
			background-color: #ffffff;
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.15),
				1px 1px 5px rgba(255, 255, 255, 0.3),
				inset 2px 2px 5px rgba(0, 0, 0, 0.05),
				inset -1px -1px 5px rgba(255, 255, 255, 0.4);
		}

		.btn {
			padding: 12px 40px;
			cursor: pointer;
			background: #008080;
			border-radius: 12px;
			border: 2px solid rgba(255, 255, 255, 0.3);
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.15),
				1px 1px 5px rgba(255, 255, 255, 0.3);
			color: #ffffff;
			font-size: 16px;
			font-weight: bold;
			transition: 0.35s;
			width: 100%;
		}

		.btn:hover {
			transform: scale(1.02);
			background: #006767;
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.2),
				1px 1px 5px rgba(255, 255, 255, 0.3),
				inset 2px 2px 5px rgba(0, 0, 0, 0.1),
				inset -1px -1px 5px rgba(255, 255, 255, 0.2);
		}

		.form .switch {
			font-size: 14px;
			color: #e0e0e0;
			text-align: center;
		}

		.form .switch .signup_tog {
			font-weight: 700;
			cursor: pointer;
			color: #8AF0BF;
			text-decoration: none;
			transition: 0.3s;
		}

		.form .switch .signup_tog:hover {
			color: #D6FFC1;
			text-decoration: underline;
		}

		.container #signup_toggle {
			display: none;
		}

		.container #signup_toggle:checked+.form {
			transform: rotateY(-180deg);
		}

		/* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
		.error-message {
			color: #e53e3e;
			font-size: 14px;
			text-align: center;
			margin-top: -10px;
			min-height: 20px;
			font-weight: 500;
		}

		.success-message {
			color: #38a169;
			font-size: 14px;
			text-align: center;
			margin-top: -10px;
			min-height: 20px;
			font-weight: 500;
		}

		/* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
		.error-message {
			font-size: 14px;
			text-align: center;
			margin-top: -10px;
			min-height: 20px;
			font-weight: 500;
		}

		.success-message {
			font-size: 14px;
			text-align: center;
			margin-top: -10px;
			min-height: 20px;
			font-weight: 500;
		}

		/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
		@media (max-width: 480px) {

			.form .form_front,
			.form .form_back {
				padding: 40px 25px;
			}

			.title {
				font-size: 2rem;
			}

			.logo {
				font-size: 2.5rem;
			}
		}
	</style>
</head>

<body>
	<div class="app-container">
		<div class="header">
			<div class="logo">üìö</div>
			<h1 class="title">Memboost</h1>
			<p class="subtitle">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
		</div>

		<div class="container">
			<input type="checkbox" id="signup_toggle">
			<form class="form" id="authForm">
				<!-- –õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ - –í—Ö–æ–¥ -->
				<div class="form_front">
					<div class="form_details">–í—Ö–æ–¥</div>
					<input type="text" class="input" id="loginIdentifier" placeholder="Email –∏–ª–∏ –ª–æ–≥–∏–Ω" required>
					<input type="password" class="input" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
					<div class="error-message" id="loginError"></div>
					<button type="button" class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
					<span class="switch">
						–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?
						<label class="signup_tog" for="signup_toggle">
							–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
						</label>
					</span>
				</div>

				<!-- –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
				<div class="form_back">
					<div class="form_details">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
					<input type="text" class="input" id="regUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
					<input type="email" class="input" id="regEmail" placeholder="Email" required>
					<input type="password" class="input" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
					<input type="password" class="input" id="regConfirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
					<div class="error-message" id="regError"></div>
					<div class="success-message" id="regSuccess"></div>
					<button type="button" class="btn" onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
					<span class="switch">
						–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
						<label class="signup_tog" for="signup_toggle">
							–í–æ–π—Ç–∏
						</label>
					</span>
				</div>
			</form>
		</div>
	</div>

	<script>
		const API_URL = 'https://memboost.ru/api';

		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
		function showError(elementId, message) {
			const errorElement = document.getElementById(elementId);
			errorElement.textContent = message;
			errorElement.style.color = '#97FA9A'; // –¢–µ–º–Ω–æ-–±–∏—Ä—é–∑–æ–≤—ã–π –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã
		}

		function showSuccess(elementId, message) {
			const successElement = document.getElementById(elementId);
			successElement.textContent = message;
			successElement.style.color = '#97FA9A'; // –ó–µ–ª–µ–Ω—ã–π –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã
		}

		function clearMessages() {
			document.getElementById('loginError').textContent = '';
			document.getElementById('regError').textContent = '';
			document.getElementById('regSuccess').textContent = '';
		}

		function clearErrors() {
			document.getElementById('loginError').textContent = '';
			document.getElementById('regError').textContent = '';
			document.getElementById('regSuccess').textContent = '';
		}

		// –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
		async function login() {
			clearMessages();

			const identifier = document.getElementById('loginIdentifier').value;
			const password = document.getElementById('loginPassword').value;

			if (!identifier || !password) {
				showError('loginError', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
				return;
			}

			try {
				const response = await fetch(`${API_URL}/auth/local`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ identifier, password })
				});

				const result = await response.json();

				if (response.ok && result.jwt) {
					// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
					localStorage.setItem('jwt', result.jwt);
					localStorage.setItem('user', JSON.stringify(result.user));
					showSuccess('loginError', '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');

					setTimeout(() => {
						window.location.href = 'main.html';
					}, 1000);
				} else {
					// –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ Strapi –Ω–∞ —Ä—É—Å—Å–∫–∏–π
					let errorMessage = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
					if (result.error?.message === 'Invalid identifier or password') {
						errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π email/–ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
					} else if (result.error?.message === 'Your account email is not confirmed') {
						errorMessage = 'Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω';
					} else if (result.error?.message) {
						errorMessage = result.error.message;
					}
					showError('loginError', errorMessage);
				}
			} catch (error) {
				showError('loginError', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
			}
		}

		// –§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
		async function register() {
			clearMessages();

			const username = document.getElementById('regUsername').value;
			const email = document.getElementById('regEmail').value;
			const password = document.getElementById('regPassword').value;
			const confirmPassword = document.getElementById('regConfirmPassword').value;

			// –í–∞–ª–∏–¥–∞—Ü–∏—è
			if (!username || !email || !password || !confirmPassword) {
				showError('regError', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
				return;
			}

			if (password !== confirmPassword) {
				showError('regError', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
				return;
			}

			if (password.length < 6) {
				showError('regError', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
				return;
			}

			if (!email.includes('@')) {
				showError('regError', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
				return;
			}

			try {
				const response = await fetch(`${API_URL}/auth/local/register`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						username: username,
						email: email,
						password: password
					})
				});

				const result = await response.json();

				if (response.ok && result.jwt) {
					showSuccess('regSuccess', '‚úÖ –ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...');
					showError('regError', '');

					// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
					localStorage.setItem('jwt', result.jwt);
					localStorage.setItem('user', JSON.stringify(result.user));

					setTimeout(() => {
						window.location.href = 'main.html';
					}, 2000);
				} else {
					// –ü–µ—Ä–µ–≤–æ–¥ –æ—à–∏–±–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
					let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
					if (result.error?.message?.includes('email')) {
						errorMessage = '–≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è';
					} else if (result.error?.message?.includes('username')) {
						errorMessage = '–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç';
					} else if (result.error?.message) {
						errorMessage = result.error.message;
					}
					showError('regError', errorMessage);
				}
			} catch (error) {
				showError('regError', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
			}
		}
		// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ —Ñ–æ—Ä–º–∞—Ö
		document.getElementById('loginPassword').addEventListener('keypress', function (e) {
			if (e.key === 'Enter') {
				login();
			}
		});

		document.getElementById('regConfirmPassword').addEventListener('keypress', function (e) {
			if (e.key === 'Enter') {
				register();
			}
		});

		// –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–æ—Ä–º
		document.getElementById('signup_toggle').addEventListener('change', clearErrors);
	</script>
</body>

</html>